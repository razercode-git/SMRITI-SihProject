<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Screening Test</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .hidden { display: none; }
    .stroop-word { font-size: 2em; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Screening Test</h2>
    <div id="memoryTest">
      <h3>Memory Test</h3>
      <p id="words"></p>
      <input type="text" id="recallInput" class="hidden" placeholder="Recall the words, comma separated">
      <button id="recallBtn" class="hidden" onclick="nextTest()">Next</button>
    </div>
    <div id="attentionTest" class="hidden">
      <h3>Attention (Stroop) Test</h3>
      <span id="stroop" class="stroop-word"></span><br>
      <select id="stroopSelect">
        <option value="Red">Red</option>
        <option value="Blue">Blue</option>
        <option value="Green">Green</option>
        <option value="Yellow">Yellow</option>
      </select>
      <button onclick="nextTest()">Next</button>
    </div>
    <div id="speechTest" class="hidden">
      <h3>Speech Test</h3>
      <button id="recordBtn">Record</button>
      <button id="stopBtn" class="hidden">Stop</button>
      <audio id="audioPlayback" controls class="hidden"></audio>
      <br>
      <a href="result.html"><button>Submit Test</button></a>
    </div>
  </div>
  <script>
    // Memory Test
    const wordsArr = ['apple','car','tree','dog','book','river','star','phone','cup','house'];
    const selectedWords = [];
    while(selectedWords.length < 5) {
      const w = wordsArr[Math.floor(Math.random()*wordsArr.length)];
      if(!selectedWords.includes(w)) selectedWords.push(w);
    }
    document.getElementById('words').textContent = selectedWords.join(', ');
    setTimeout(() => {
      document.getElementById('words').style.display = 'none';
      document.getElementById('recallInput').classList.remove('hidden');
      document.getElementById('recallBtn').classList.remove('hidden');
    }, 5000);

    let testStep = 0;
    function nextTest() {
      testStep++;
      if(testStep === 1) {
        document.getElementById('memoryTest').classList.add('hidden');
        document.getElementById('attentionTest').classList.remove('hidden');
        // Stroop test
        const colors = ['Red','Blue','Green','Yellow'];
        const word = colors[Math.floor(Math.random()*colors.length)];
        let color = colors[Math.floor(Math.random()*colors.length)];
        while(color === word) color = colors[Math.floor(Math.random()*colors.length)];
        document.getElementById('stroop').textContent = word;
        document.getElementById('stroop').style.color = color.toLowerCase();
      } else if(testStep === 2) {
        document.getElementById('attentionTest').classList.add('hidden');
        document.getElementById('speechTest').classList.remove('hidden');
      }
    }

    // Speech Test
    let mediaRecorder, audioChunks = [];
    const recordBtn = document.getElementById('recordBtn');
    const stopBtn = document.getElementById('stopBtn');
    const audioPlayback = document.getElementById('audioPlayback');
    recordBtn.onclick = () => {
      navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        audioChunks = [];
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks);
          audioPlayback.src = URL.createObjectURL(audioBlob);
          audioPlayback.classList.remove('hidden');
        };
        recordBtn.classList.add('hidden');
        stopBtn.classList.remove('hidden');
      });
    };
    stopBtn.onclick = () => {
      mediaRecorder.stop();
      stopBtn.classList.add('hidden');
      recordBtn.classList.remove('hidden');
    };
  </script>
</body>
</html>